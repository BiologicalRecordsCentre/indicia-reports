<report
    title="Overall sample statistics"
    description="Stats for Beach Track track samples"
    featured="true"
>
  <query>
  -- User leaderboard
  select #columns#
  from samples s
  join users u on u.id=s.created_by_id and u.deleted=false
  join people p on p.id=u.person_id and p.deleted=false
  join sample_attribute_values vstart on vstart.sample_id=s.id and vstart.sample_attribute_id=1715 and vstart.deleted=false
  join sample_attribute_values vend on vend.sample_id=s.id and vend.sample_attribute_id=1716 and vend.deleted=false
  where survey_id=721
  and sample_method_id=2424
  and s.created_by_id=#created_by_id#
  </query>
  <params>
    <param name="created_by_id" display="User ID" datatype="integer"/>
  </params>
  <columns>
    <column name="total_tracks_count" sql="count(distinct s.id)" aggregate="true" />
    <column name="total_distance_walked" sql="round(sum(st_length(st_transform(geom, 27700))))" aggregate="true" />
    <column name="total_time_spent" sql="sum(extract(epoch from (vend.text_value::timestamp - vstart.text_value::timestamp))/3600)" aggregate="true" />
    <column name="total_occurrences_count" sql="(select count(*) from occurrences where created_by_id=#created_by_id# and website_id=153 and deleted=false)" aggregate="true" />
  </columns>
</report>
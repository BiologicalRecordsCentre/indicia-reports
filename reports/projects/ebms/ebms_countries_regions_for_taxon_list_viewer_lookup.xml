<report
    title="EBMS Countries regions For Taxon List Viewer Lookup"
    description="Report that populates the counties and regions in the taxon list viewer."
>
  <query>
    SELECT distinct #columns#
    FROM taxa_taxon_list_attributes ttla
    JOIN taxon_lists_taxa_taxon_list_attributes tlttla 
      ON tlttla.taxa_taxon_list_attribute_id = ttla.id
      AND tlttla.taxon_list_id in (#taxon_list_ids#)
      AND tlttla.deleted=false
    JOIN taxa_taxon_list_attribute_values ttlav on
      ttlav.taxa_taxon_list_attribute_id = ttla.id
      AND ttlav.deleted = false
    LEFT JOIN locations l on l.code = ttla.caption
      AND l.deleted = false and l.location_type_id in (#countries_regions_location_type_ids#)
    WHERE ttla.termlist_id = #species_presence_termlist_id#
    AND ttla.deleted = false
  </query>
  <order_bys>
    <order_by>loc_name</order_by>
  </order_bys>
  <params>
    <param name="species_presence_termlist_id" display="Termlist ID" datatype="int"
        description="The ID of the termlist that hold species precence values." />
    <param name="taxon_list_ids" display="Taxon list IDs" datatype="text"
        description="Comma separated list of taxon list Ids." />
    <param name="countries_regions_location_type_ids" display="Country region location type ids" datatype="int"
        description="Limit to location type id." />
  </params>
  <columns>
    <column name='ttla_id' display='Taxa taxon list attribute ID' sql='ttla.id' datatype="int" />
    <column name='loc_name' display='Location name' sql='coalesce(l.name, ttla.caption)' datatype="text" />
  </columns>
</report>
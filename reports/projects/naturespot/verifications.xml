<?xml version="1.0" encoding="UTF-8"?>
<report title="Verifications"
    description="Lists verifications of NS records.">
  <query website_filter_field="">
    select distinct on (o.id)
      #columns#
    from cache_occurrences_functional o
    join cache_taxa_taxon_lists cttl on cttl.id=o.taxa_taxon_list_id
    join occurrence_comments ocv on ocv.occurrence_id=o.id and ocv.deleted=false and ocv.record_status is not null and ocv.created_on&lt;o.verified_on
    where o.website_id=8
  </query>
  <order_bys>
    <order_by>o.id, ocv.id desc</order_by>
  </order_bys>
  <columns>
    <column name="occurrence_id" display="Record ID" datatype="integer" sql="o.id" />
    <column name="created_on" display="Date submitted" datatype="date" sql="o.created_on" />
    <column name="input_year" display="Year submitted" datatype="integer" sql="extract(year from o.created_on)" />
    <column name="current_determination" display="Current determination" datatype="text" sql="cttl.taxon" />
    <column name="current_status" display="Current status" datatype="text" sql="
      CASE o.record_status || coalesce(o.record_substatus::text, '')
        WHEN 'V' THEN 'accepted'
        WHEN 'V1' THEN 'accepted as correct'
        WHEN 'V2' THEN 'accepted as considered correct'
        WHEN 'C' THEN 'pending'
        WHEN 'C3' THEN 'plausible'
        WHEN 'R' THEN 'rejected'
        WHEN 'R4' THEN 'rejected as unable to verify'
        WHEN 'R5' THEN 'rejected as incorrect'
        ELSE o.record_status || coalesce(o.record_substatus::text, '')
      END" />
    <column name="current_verification_date" display="Current verification date" datatype="date" sql="o.verified_on" />
    <column name="previous_status" display="Previous status" datatype="text" sql="
      CASE ocv.record_status || coalesce(ocv.record_substatus::text, '')
        WHEN 'V' THEN 'accepted'
        WHEN 'V1' THEN 'accepted as correct'
        WHEN 'V2' THEN 'accepted as considered correct'
        WHEN 'C' THEN 'pending'
        WHEN 'C3' THEN 'plausible'
        WHEN 'R' THEN 'rejected'
        WHEN 'R4' THEN 'rejected as unable to verify'
        WHEN 'R5' THEN 'rejected as incorrect'
        ELSE ocv.record_status || coalesce(ocv.record_substatus::text, '')
      END" />
    <column name="previous_verification_date" display="Previous verification date" datatype="date" sql="ocv.created_on" />
  </columns>
</report>